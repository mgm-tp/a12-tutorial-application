{
  "name": "Extend Data Services Permission Definition",
  "description": "Authorization for user access",
  "policies": [
    {
      "name": "Document Read By User Created",
      "description": "User is only able to read the documents created by them",
      "target": "hasAccessRight('DOCUMENT_READ') && !containsAnyRole('admin')",
      "rules": [
        "principal.username == #resource.kernelDocument.__meta.creator"
      ]
    },
    {
      "name": "Document Delete By User Created",
      "description": "User is only able to delete the documents created by them",
      "target": "hasAccessRight('DOCUMENT_DELETE') && !containsAnyRole('admin')",
      "rules": [
        "principal.username == #resource.kernelDocument.__meta.creator"
      ]
    },
    {
      "name": "Document Update By User Created",
      "description": "User is only able to update the documents created by them",
      "target": "hasAccessRight('DOCUMENT_UPDATE') && !containsAnyRole('admin')",
      "rules": [
        "principal.username == #resource.oldDocument.__meta.creator"
      ]
    },
    {
      "name": "User Has Actuator Path Access",
      "description": "Users with access right ACCESS_ACTUATOR are allowed to access /actuator/** path",
      "rules": [
        "hasAccessRight('ACCESS_ACTUATOR')"
      ]
    }
  ],
  "repositoryPolicies": [
    {
      "name": "Document List By User Created",
      "description": "User is only able to see the documents created by them",
      "target": "hasAccessRight('DOCUMENT_LIST') && !containsAnyRole('admin')",
      "templates": [
        "'__meta.creator:' + principal.username"
      ]
    }
  ],
  "permissions": [
    {
      "name": "User Read Document Permission",
      "policy-refs": [
        "Document Read By User Created"
      ],
      "scopes": [
        "Document Read"
      ]
    },
    {
      "name": "User Delete Document Permission",
      "policy-refs": [
        "Document Delete By User Created"
      ],
      "scopes": [
        "Document Delete"
      ]
    },
    {
      "name": "User Update Document Permission",
      "policy-refs": [
        "Document Update By User Created"
      ],
      "scopes": [
        "Document Update"
      ]
    },
    {
      "name": "User List Document Permission",
      "repository-refs": [
        "Document List By User Created"
      ],
      "scopes": [
        "Document List"
      ]
    },
    {
      "name": "Actuator Access Permission",
      "description": "Control actuator accessibility by relative URL",
      "policy-refs": [
        "User Has Actuator Path Access"
      ],
      "scopes": [
        "RelativePath"
      ]
    }
  ]
}
